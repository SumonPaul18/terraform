### Terraform

---

## ЁЯУШ **Terraform тАУ ржкрж░рзНржм рзз: ржнрзВржорж┐ржХрж╛ ржУ ржмрзЗрж╕рж┐ржХ ржзрж╛рж░ржгрж╛**

### ЁЯза Terraform ржХрзА?

**Terraform** рж╣рж▓рзЛ ржПржХржЯрж┐ ржУржкрзЗржи-рж╕рзЛрж░рзНрж╕ **Infrastructure as Code (IaC)** ржЯрзБрж▓, ржпрж╛ рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗ [HashiCorp]ред ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржХрзЛржб ржжрж┐рзЯрзЗ рж╕рж╛рж░рзНржнрж╛рж░, ржирзЗржЯржУрзЯрж╛рж░рзНржХ, ржбрзЗржЯрж╛ржмрзЗржЗрж╕, ржХрзНрж▓рж╛ржЙржб рж░рж┐рж╕рзЛрж░рзНрж╕ ржЗрждрзНржпрж╛ржжрж┐ рждрзИрж░рж┐, ржХржиржлрж┐ржЧрж╛рж░ ржПржмржВ ржорзНржпрж╛ржирзЗржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

ЁЯЯв ржЙржжрж╛рж╣рж░ржг:
- AWS-ржП EC2 instance ржЪрж╛рж▓рзБ ржХрж░рж╛
- GCP-рждрзЗ VM рждрзИрж░рж┐ ржХрж░рж╛
- Azure-ржП ржПржХржЯрж┐ Database рждрзИрж░рж┐ ржХрж░рж╛
- ржПржХржЯрж┐ Load Balancer + Auto Scaling Group рждрзИрж░рж┐ ржХрж░рж╛

---

### ЁЯПЧя╕П **Infrastructure as Code (IaC) ржХрзА?**

IaC рж╣рж▓рзЛ ржПржоржи ржПржХржЯрж┐ ржкржжрзНржзрждрж┐ ржпрзЗржЦрж╛ржирзЗ ржЖржкржирж┐ ржЖржкржирж╛рж░ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ (ржпрзЗржоржи: VM, ржбрзЗржЯрж╛ржмрзЗржЗрж╕, ржирзЗржЯржУрзЯрж╛рж░рзНржХ) ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ ржирж╛ ржХрж░рзЗ **ржХрзЛржбрзЗ рж▓рж┐ржЦрзЗ** рждрзИрж░рж┐ ржХрж░рзЗржиред

тЮбя╕П ржпрзЗржоржи: ржЖржЧрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ AWS Console-ржП ржЧрж┐рзЯрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзЗ Instance ржЪрж╛рж▓рзБ ржХрж░рждрж╛ржоред ржПржЦржи Terraform ржжрж┐рзЯрзЗ ржЖржорж░рж╛ `main.tf` ржирж╛ржорзЗ ржПржХржЯрж┐ ржлрж╛ржЗрж▓рзЗ рж▓рж┐ржЦрзЗржЗ рж╕рзЗржЯрж┐ ржЪрж╛рж▓рзБ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

```hcl
resource "aws_instance" "my_server" {
  ami           = "ami-123456"
  instance_type = "t2.micro"
}
```

---

### тЬЕ Terraform ржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?

| рж╕рзБржмрж┐ржзрж╛ | ржмрзНржпрж╛ржЦрзНржпрж╛ |
|--------|---------|
| ЁЯФБ рж░рж┐ржкрзНрж░рзЛржбрж┐ржЙрж╕рзЗржмрж▓ | ржмрж╛рж░ ржмрж╛рж░ ржПржХрж┐ ржХрзЛржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХрж┐ ржЗржиржлрзНрж░рж╛ рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛рзЯ |
| ЁЯФД ржнрж╛рж░рзНрж╕ржи ржХржирзНржЯрзНрж░рзЛрж▓ | Git ржжрж┐рзЯрзЗ ржЗржиржлрзНрж░рж╛ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ рж╣рж┐рж╕рж╛ржм рж░рж╛ржЦрж╛ ржпрж╛рзЯ |
| ЁЯФН ржкрж░рж┐ржХрж▓рзНржкржирж╛ ржУ ржпрж╛ржЪрж╛ржЗ | Terraform `plan` ржжрж┐рзЯрзЗ ржЖржЧрзЗ ржжрзЗржЦрзЗ ржирзЗржУрзЯрж╛ ржпрж╛рзЯ ржХрзА ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ |
| ЁЯМР ржорж╛рж▓рзНржЯрж┐-ржХрзНрж▓рж╛ржЙржб рж╕рж╛ржкрзЛрж░рзНржЯ | AWS, Azure, GCPтАФрж╕ржм ржЬрж╛рзЯржЧрж╛рзЯ ржХрж╛ржЬ ржХрж░рзЗ |

---

### ЁЯУж Terraform ржХрзА ржХрзА рж░рж┐рж╕рзЛрж░рзНрж╕ ржорзНржпрж╛ржирзЗржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗ?

Terraform рж╣рж╛ржЬрж╛рж░рзЗрж░ ржмрзЗрж╢рж┐ Provider рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ:
- тШБя╕П AWS, Azure, GCP
- ЁЯР│ Docker
- тШБя╕П DigitalOcean
- ЁЯз▒ Kubernetes
- ЁЯФР Vault
- ЁЯУб Cloudflare
- ... ржЖрж░ржУ ржЕржирзЗржХ ржХрж┐ржЫрзБ!

---

### ЁЯЫая╕П Terraform Workflow

Terraform ржХрж╛ржЬ ржХрж░рзЗ рзкржЯрж┐ ржзрж╛ржкрзЗ:

| ржзрж╛ржк | ржХрзА ржХрж░рзЗ? |
|------|--------|
| 1я╕ПтГг `terraform init` | Provider & ржкрзНрж▓рж╛ржЧржЗржи ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзЗ |
| 2я╕ПтГг `terraform plan` | ржХрзА ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ рждрж╛ ржжрзЗржЦрж╛рзЯ |
| 3я╕ПтГг `terraform apply` | ржмрж╛рж╕рзНрждржмрзЗ рж░рж┐рж╕рзЛрж░рзНрж╕ рждрзИрж░рж┐ ржХрж░рзЗ |
| 4я╕ПтГг `terraform destroy` | рж╕ржм рж░рж┐рж╕рзЛрж░рзНрж╕ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ |

---

### ЁЯУБ Terraform ржлрж╛ржЗрж▓ ржЧрзБрж▓рзЛ ржХрзЗржоржи рж╣рзЯ?

- `.tf` = Terraform ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓
- `.tfvars` = Variables-ржПрж░ ржнрзНржпрж╛рж▓рзБ
- `terraform.tfstate` = ржЗржиржлрзНрж░рж╛рж░ ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ

---

### ЁЯФЪ ржкрзНрж░ржержо ржкрж░рзНржмрзЗрж░ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк:

- Terraform рж╣рж▓рзЛ ржХрзЛржб ржжрж┐рзЯрзЗ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛рж░ ржЯрзБрж▓
- ржПржЯрж┐ IaC ржлрж▓рзЛ ржХрж░рзЗ ржПржмржВ ржЕржирзЗржХ provider рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ
- ржПржЯрж╛ ржжрж┐рзЯрзЗ ржЖржкржирж┐ ржХрзНрж▓рж╛ржЙржб рж░рж┐рж╕рзЛрж░рзНрж╕ ржЕржЯрзЛржорзЗрж╢ржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржи
- Terraform ржХрзЛржбржЧрзБрж▓рзЛ `.tf` ржлрж╛ржЗрж▓рзЗ рж▓рзЗржЦрж╛ рж╣рзЯ

---

**Linux ржП Terraform ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи** ржПржмржВ рждрж╛рж░ ржкрж░ **Terraform ржПрж░ ржкрзНрж░рж╛ржержорж┐ржХ ржмрзНржпржмрж╣рж╛рж░**ред

---

### ЁЯЦея╕П **Linux ржП Terraform ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи**

#### ржзрж╛ржк рзз: Terraform ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ ржЬржирзНржп prerequisites
- ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржПржХржЯрж┐ **Linux ржорзЗрж╢рж┐ржи** ржерж╛ржХрждрзЗ рж╣ржмрзЗред
- **sudo** ржмрж╛ root privilege ржерж╛ржХрждрзЗ рж╣ржмрзЗред

#### ржзрж╛ржк рзи: Terraform ржПрж░ ржЕржлрж┐рж╕рж┐рзЯрж╛рж▓ ржкрзНржпрж╛ржХрзЗржЬ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж╛
1. ржкрзНрж░ржержорзЗ Terraform ржПрж░ рж╕рж░рзНржмрж╢рзЗрж╖ ржнрж╛рж░рзНрж╕ржи ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ рж╣ржмрзЗред ржП ржЬржирзНржп `wget` ржмрж╛ `curl` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред 

```bash
# рзз. HashiCorp-ржПрж░ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж╛рж░ ржЬржирзНржп commands:
sudo apt-get update && sudo apt-get install -y gnupg software-properties-common curl

# рзи. Terraform GPG key ржпрзЛржЧ ржХрж░рзБржи
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg

# рзй. Terraform-ржПрж░ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржпрзЛржЧ ржХрж░рзБржи
sudo apt-add-repository \
    "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main"

# рзк. Terraform ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи
sudo apt-get update && sudo apt-get install terraform
```

#### ржзрж╛ржк рзй: Terraform ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи ржЪрзЗржХ ржХрж░рж╛
Terraform рж╕ржлрж▓ржнрж╛ржмрзЗ ржЗржирж╕рзНржЯрж▓ рж╣рзЯрзЗржЫрзЗ ржХрж┐ржирж╛, ржЪрзЗржХ ржХрж░рждрзЗ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЯрж┐ рж░рж╛ржи ржХрж░рзБржи:

```bash
terraform -v
```

ржПржЯрж┐ Terraform ржПрж░ ржЗржирж╕рзНржЯрж▓ рж╣ржУрзЯрж╛ ржнрж╛рж░рзНрж╕ржи ржжрзЗржЦрж╛ржмрзЗ, ржпрзЗржоржи:  
`Terraform v1.4.6`

---

### ЁЯЫая╕П **Terraform ржПрж░ ржкрзНрж░рж╛ржержорж┐ржХ ржмрзНржпржмрж╣рж╛рж░**

#### рзз. **ржкрзНрж░ржержо Terraform ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рж╛**

ржзрж░рж╛ ржпрж╛ржХ ржЖржорж░рж╛ AWS EC2 instance рждрзИрж░рж┐ ржХрж░рждрзЗ ржЪрж╛ржЗред ржПржЬржирзНржп ржЖржорж╛ржжрзЗрж░ ржПржХржЯрж┐ `main.tf` ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ:

1. ржПржХржЯрж┐ ржирждрзБржи ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐ ржХрж░рзБржи:

```bash
mkdir terraform-demo
cd terraform-demo
```

2. ржПржХржЯрж┐ `main.tf` ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи:

```bash
touch main.tf
```

3. `main.tf` ржлрж╛ржЗрж▓рзЗрж░ ржоржзрзНржпрзЗ ржХрзЛржб рж▓рж┐ржЦрзБржи:

```hcl
# AWS Provider ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи
provider "aws" {
  region = "us-east-1"  # ржЖржкржирж╛рж░ рж╕ржарж┐ржХ AWS region ржжрж┐ржи
}

# EC2 instance рждрзИрж░рж┐ ржХрж░рж╛
resource "aws_instance" "example" {
  ami           = "ami-0c55b159cbfafe1f0" # рж╕ржарж┐ржХ AMI ID ржжрж┐ржи
  instance_type = "t2.micro"               # ржЖржкржирж╛рж░ ржкрзНрж░рзЯрзЛржЬржи ржЕржирзБржпрж╛рзЯрзА
}
```

#### рзи. **Terraform ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрзНрж░рзЯрзЛржЧ ржХрж░рж╛**

ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ рж▓рж┐ржЦрзЗ ржирзЗржУрзЯрж╛рж░ ржкрж░ Terraform ржПрж░ рзкржЯрж┐ ржорзВрж▓ ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗ:

1. **`terraform init`** тАУ ржПржЯрж╛ Terraform ржкрзНрж░ржЬрзЗржХрзНржЯ рж╢рзБрж░рзБ ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗ ржПржмржВ ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржкрзНрж▓рж╛ржЧржЗржи ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзЗред

```bash
terraform init
```

2. **`terraform plan`** тАУ ржПржЯрж┐ ржЖржкржирж╛рж░ ржХрзЛржбрзЗ ржХрж┐ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ рждрж╛ ржжрзЗржЦрж╛ржмрзЗ, ржпрзЗржоржи ржирждрзБржи EC2 instance рждрзИрж░рж┐ рж╣ржмрзЗред

```bash
terraform plan
```

ржПржЯрж┐ ржЪрж▓рж▓рзЗ ржЖржкржирж┐ ржХрж┐ржЫрзБ ржПрж░рж░ ржмрж╛ рж╕ржорзНржнрж╛ржмрзНржп ржкрж░рж┐ржмрж░рзНрждржи ржжрзЗржЦрждрзЗ ржкрж╛рж░ржмрзЗржиред 

3. **`terraform apply`** тАУ ржкрзНрж░ржХрзГрждржкржХрзНрж╖рзЗ Terraform ржХрзЛржб ржкрзНрж░рзЯрзЛржЧ ржХрж░ржмрзЗ ржПржмржВ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ рждрзИрж░рж┐ ржХрж░ржмрзЗред

```bash
terraform apply
```

ржПржЯрж┐ рж╕ржлрж▓ржнрж╛ржмрзЗ ржЪрж╛рж▓рж╛ржирзЛрж░ ржкрж░рзЗ, Terraform ржЖржкржирж╛ржХрзЗ ржХрзЛржб ржЕржирзБржпрж╛рзЯрзА рж░рж┐рж╕рзЛрж░рзНрж╕ рждрзИрж░рж┐ ржХрж░ржмрзЗред ржпржжрж┐ ржЖржкржирж┐ ржкржгрзНржпрзЗрж░ ржкрзНрж░ржорзНржкржЯ (confirmation) ржжрзЗржЦрждрзЗ ржЪрж╛ржи, рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ `yes` ржЯрж╛ржЗржк ржХрж░рзБржиред

4. **`terraform destroy`** тАУ ржпрзЗржХрзЛржирзЛ рж░рж┐рж╕рзЛрж░рзНрж╕ ржорзБржЫрзЗ ржлрзЗрж▓рждрзЗ, `terraform destroy` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред ржПржЯрж┐ ржЖржкржирж╛рж░ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржбрж┐рж▓рж┐ржЯ ржХрж░ржмрзЗред

```bash
terraform destroy
```

---

### тЪЩя╕П **Terraform ржкрзНрж░рж╛ржержорж┐ржХ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржмрзНржпрж╛ржЦрзНржпрж╛**

- **provider "aws"**: ржПржЯрж╛ Terraform ржХрзЗ ржмрж▓рзЗ ржпрзЗ AWS ржХрзНрж▓рж╛ржЙржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ `us-east-1` AWS region ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрж┐ред
- **resource "aws_instance" "example"**: ржПржЯрж╛ ржПржХржЯрж┐ EC2 instance рждрзИрж░рж┐ ржХрж░рж╛рж░ рж░рж┐рж╕рзЛрж░рзНрж╕, ржпрзЗржЦрж╛ржирзЗ:
  - `ami`: ржПржЯрж┐рж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржпрзЗ AMI ID (Amazon Machine Image) ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи рждрж╛ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рзЗржиред 
  - `instance_type`: ржПржЦрж╛ржирзЗ ржЖржкржирж┐ ржпрзЗ EC2 instance type ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи, рж╕рзЗржЯрж╛ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░ржмрзЗржиред

---

### ЁЯУЪ **Terraform ржмрзНржпржмрж╣рж╛рж░ рж╕ржВржХрзНрж░рж╛ржирзНржд ржХрж┐ржЫрзБ ржорзВрж▓ ржзрж╛рж░ржгрж╛**

- **Resources**: ржЖржкржирж╛рж░ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ рждрзИрж░рж┐ ржмрж╛ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛рж░ ржЬржирзНржп Terraform 'resource' ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржпрзЗржоржи `aws_instance`, `aws_security_group`, `aws_s3_bucket` ржЗрждрзНржпрж╛ржжрж┐ред
  
- **Providers**: Terraform ржХрзНрж▓рж╛ржЙржб ржмрж╛ рж╕рж╛рж░рзНржнрж┐рж╕ ржкрзНрж░рзЛржнрж╛ржЗржбрж╛рж░ржжрзЗрж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж╛рж░ржЕрзНржпрж╛ржХрзНржЯ ржХрж░рждрзЗ ржкрзНрж░рзЛржнрж╛ржЗржбрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред AWS, Azure, GCP ржЗрждрзНржпрж╛ржжрж┐ред

- **Variables**: ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржиржЧрзБрж▓рзЛржХрзЗ ржЖрж░ржУ ржбрж╛ржЗржирж╛ржорж┐ржХ ржУ ржкрзБржирж░рж╛рзЯ ржмрзНржпржмрж╣рж╛рж░ржпрзЛржЧрзНржп ржХрж░рж╛ ржпрж╛рзЯред ржЙржжрж╛рж╣рж░ржг:

```hcl
variable "instance_type" {
  type = string
  default = "t2.micro"
}

resource "aws_instance" "example" {
  ami           = "ami-0c55b159cbfafe1f0"
  instance_type = var.instance_type
}
```

- **Outputs**: Terraform `outputs` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржерзЗржХрзЗ рждржерзНржп ржмрзЗрж░ ржХрж░рзЗред ржЙржжрж╛рж╣рж░ржг:

```hcl
output "instance_ip" {
  value = aws_instance.example.public_ip
}
```

---

